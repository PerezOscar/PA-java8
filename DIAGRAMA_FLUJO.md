# Diagrama de Flujo - Procesador CSV MVC

## Flujo Principal del Sistema

```
                    ┌─────────────────┐
                    │   INICIO        │
                    │   Main.java     │
                    └─────────┬───────┘
                              │
                    ┌─────────▼───────┐
                    │ Validar Args    │
                    │ Mostrar Info    │
                    └─────────┬───────┘
                              │
                    ┌─────────▼───────┐
                    │ Crear Controller│
                    │ CSVProcessor    │
                    │ Controller      │
                    └─────────┬───────┘
                              │
                    ┌─────────▼───────┐
                    │ Leer Headers    │
                    │ ICSVProcessor   │
                    └─────────┬───────┘
                              │
                    ┌─────────▼───────┐
                    │ Detectar        │
                    │ Columnas        │
                    │ Numéricas       │
                    └─────────┬───────┘
                              │
                    ┌─────────▼───────┐
                    │ Cargar Datos    │
                    │ Iterator        │
                    │ Pattern         │
                    └─────────┬───────┘
                              │
                    ┌─────────▼───────┐
                    │ PROCESAMIENTO   │
                    │ DUAL            │
                    └─────┬───────────┘
                          │
              ┌───────────┴───────────┐
              │                       │
    ┌─────────▼───────┐     ┌─────────▼───────┐
    │ SECUENCIAL      │     │ CONCURRENTE     │
    │ Sequential      │     │ Concurrent      │
    │ Processor       │     │ Processor       │
    └─────────┬───────┘     └─────────┬───────┘
              │                       │
    ┌─────────▼───────┐     ┌─────────▼───────┐
    │ Procesar        │     │ Dividir en      │
    │ Registro por    │     │ Chunks          │
    │ Registro        │     └─────────┬───────┘
    └─────────┬───────┘               │
              │               ┌───────▼───────┐
              │               │ Crear Workers │
              │               │ Thread Pool   │
              │               └───────┬───────┘
              │                       │
              │               ┌───────▼───────┐
              │               │ Statistics    │
              │               │ Worker        │
              │               │ (Runnable)    │
              │               └───────┬───────┘
              │                       │
              │               ┌───────▼───────┐
              │               │ Sincronizar   │
              │               │ Resultados    │
              │               └───────┬───────┘
              │                       │
              └───────────┬───────────┘
                          │
                ┌─────────▼───────┐
                │ Combinar        │
                │ Estadísticas    │
                │ Summary         │
                └─────────┬───────┘
                          │
                ┌─────────▼───────┐
                │ Calcular        │
                │ Performance     │
                │ Report          │
                └─────────┬───────┘
                          │
                ┌─────────▼───────┐
                │ Mostrar         │
                │ Resultados      │
                │ ReportView      │
                └─────────┬───────┘
                          │
                    ┌─────▼─────┐
                    │    FIN    │
                    └───────────┘
```

## Flujo Detallado del Procesamiento Concurrente

```
┌─────────────────────────────────────────────────────────────────┐
│                 PROCESAMIENTO CONCURRENTE                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │ Datos CSV   │    │ Dividir en  │    │ Thread Pool │         │
│  │ 82M records │───▶│ Chunks      │───▶│ Manager     │         │
│  └─────────────┘    └─────────────┘    └─────────────┘         │
│                            │                    │               │
│                            ▼                    ▼               │
│                     ┌─────────────┐    ┌─────────────┐         │
│                     │ Chunk 1     │    │ Worker 1    │         │
│                     │ 10M records │───▶│ Thread      │         │
│                     └─────────────┘    └─────────────┘         │
│                            │                    │               │
│                     ┌─────────────┐    ┌─────────────┐         │
│                     │ Chunk 2     │    │ Worker 2    │         │
│                     │ 10M records │───▶│ Thread      │         │
│                     └─────────────┘    └─────────────┘         │
│                            │                    │               │
│                     ┌─────────────┐    ┌─────────────┐         │
│                     │ Chunk N     │    │ Worker N    │         │
│                     │ 10M records │───▶│ Thread      │         │
│                     └─────────────┘    └─────────────┘         │
│                                                 │               │
│                                        ┌─────────────┐         │
│                                        │ Sincronizar │         │
│                                        │ join()      │         │
│                                        └─────────────┘         │
│                                                 │               │
│                                        ┌─────────────┐         │
│                                        │ Combinar    │         │
│                                        │ Resultados  │         │
│                                        └─────────────┘         │
└─────────────────────────────────────────────────────────────────┘
```

## Flujo de Datos en el Worker Thread

```
┌─────────────────────────────────────────────────────────────────┐
│                    STATISTICS WORKER                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐                                               │
│  │ Chunk Data  │                                               │
│  │ List<CSV    │                                               │
│  │ Record>     │                                               │
│  └──────┬──────┘                                               │
│         │                                                      │
│         ▼                                                      │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│  │ For Each    │───▶│ Extract     │───▶│ Validate    │        │
│  │ Record      │    │ Numeric     │    │ Value       │        │
│  └─────────────┘    │ Values      │    └─────────────┘        │
│         │            └─────────────┘            │              │
│         │                    │                  │              │
│         ▼                    ▼                  ▼              │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│  │ Increment   │    │ Update      │    │ Calculate   │        │
│  │ Count       │    │ Statistics  │    │ Running     │        │
│  └─────────────┘    │ (Mean, Min, │    │ Variance    │        │
│         │            │ Max, Sum)   │    │ (Welford)   │        │
│         │            └─────────────┘    └─────────────┘        │
│         │                    │                  │              │
│         └────────────────────┼──────────────────┘              │
│                              │                                 │
│                              ▼                                 │
│                     ┌─────────────┐                           │
│                     │ Thread-Safe │                           │
│                     │ Statistics  │                           │
│                     │ Summary     │                           │
│                     └─────────────┘                           │
└─────────────────────────────────────────────────────────────────┘
```

## Flujo de Sincronización Thread-Safe

```
┌─────────────────────────────────────────────────────────────────┐
│                  SINCRONIZACIÓN THREAD-SAFE                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Multiple Workers                    Statistics Summary         │
│  ┌─────────────┐                   ┌─────────────────────┐     │
│  │ Worker 1    │──┐                │ synchronized        │     │
│  │ Thread      │  │                │ addColumnValue()    │     │
│  └─────────────┘  │                └─────────────────────┘     │
│                   │                          │                 │
│  ┌─────────────┐  │    ┌─────────────┐     │                 │
│  │ Worker 2    │──┼───▶│ Object      │     │                 │
│  │ Thread      │  │    │ Lock        │◄────┘                 │
│  └─────────────┘  │    └─────────────┘                       │
│                   │           │                               │
│  ┌─────────────┐  │           ▼                               │
│  │ Worker N    │──┘    ┌─────────────┐                       │
│  │ Thread      │       │ Column      │                       │
│  └─────────────┘       │ Statistics  │                       │
│                        │ Update      │                       │
│                        └─────────────┘                       │
│                               │                               │
│                               ▼                               │
│                        ┌─────────────┐                       │
│                        │ Welford     │                       │
│                        │ Algorithm   │                       │
│                        │ (Online     │                       │
│                        │ Variance)   │                       │
│                        └─────────────┘                       │
└─────────────────────────────────────────────────────────────────┘
```

## Flujo de Manejo de Memoria para 82M Registros

```
┌─────────────────────────────────────────────────────────────────┐
│                   MANEJO DE MEMORIA EFICIENTE                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │ CSV File    │    │ Iterator    │    │ Streaming   │         │
│  │ 82M Records │───▶│ Pattern     │───▶│ Processing  │         │
│  │ ~10GB       │    │ (No load    │    │ (Chunk by   │         │
│  └─────────────┘    │ all in RAM) │    │ Chunk)      │         │
│                     └─────────────┘    └─────────────┘         │
│                            │                    │               │
│                            ▼                    ▼               │
│                     ┌─────────────┐    ┌─────────────┐         │
│                     │ Buffer      │    │ Process     │         │
│                     │ 8KB         │    │ & Release   │         │
│                     │ Configurable│    │ Memory      │         │
│                     └─────────────┘    └─────────────┘         │
│                            │                    │               │
│                            ▼                    ▼               │
│                     ┌─────────────┐    ┌─────────────┐         │
│                     │ Parse Line  │    │ GC Friendly │         │
│                     │ to Record   │    │ Processing  │         │
│                     └─────────────┘    └─────────────┘         │
│                            │                    │               │
│                            └────────┬───────────┘               │
│                                     │                           │
│                                     ▼                           │
│                            ┌─────────────┐                     │
│                            │ Statistics  │                     │
│                            │ Only in RAM │                     │
│                            │ (~1MB)      │                     │
│                            └─────────────┘                     │
└─────────────────────────────────────────────────────────────────┘
```

## Flujo de Decisión de Procesamiento

```
                    ┌─────────────────┐
                    │ Analizar Dataset│
                    └─────────┬───────┘
                              │
                    ┌─────────▼───────┐
                    │ Tamaño < 10K?   │
                    └─────┬───────┬───┘
                          │ Sí    │ No
                          ▼       ▼
                ┌─────────────┐ ┌─────────────┐
                │ Usar        │ │ Usar        │
                │ SEQUENTIAL  │ │ CONCURRENT  │
                └─────────────┘ └─────────────┘
                          │       │
                          │       ▼
                          │ ┌─────────────┐
                          │ │ Cores > 4?  │
                          │ └─────┬───┬───┘
                          │       │Sí │No
                          │       ▼   ▼
                          │ ┌─────────────┐
                          │ │ Usar 8      │
                          │ │ Threads     │
                          │ └─────────────┘
                          │       │
                          └───────┼───────┐
                                  │       │
                        ┌─────────▼───────▼─┐
                        │ Ejecutar Ambos    │
                        │ Comparar          │
                        │ Rendimiento       │
                        └───────────────────┘
```

## Flujo de Cálculo de Estadísticas (Algoritmo de Welford)

```
┌─────────────────────────────────────────────────────────────────┐
│              ALGORITMO DE WELFORD (ONLINE VARIANCE)            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Para cada valor nuevo:                                         │
│                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │ count++     │───▶│ delta =     │───▶│ mean +=     │         │
│  │             │    │ value-mean  │    │ delta/count │         │
│  └─────────────┘    └─────────────┘    └─────────────┘         │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │ sum +=      │    │ delta2 =    │    │ m2 +=       │         │
│  │ value       │    │ value-mean  │    │ delta*delta2│         │
│  └─────────────┘    └─────────────┘    └─────────────┘         │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │ min = min   │    │ max = max   │    │ variance =  │         │
│  │ (min,value) │    │ (max,value) │    │ m2/(count-1)│         │
│  └─────────────┘    └─────────────┘    └─────────────┘         │
│                                                 │               │
│                                                 ▼               │
│                                        ┌─────────────┐         │
│                                        │ stddev =    │         │
│                                        │ sqrt(var)   │         │
│                                        └─────────────┘         │
└─────────────────────────────────────────────────────────────────┘
```

## Flujo de Generación de Reportes

```
┌─────────────────────────────────────────────────────────────────┐
│                    GENERACIÓN DE REPORTES                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │ Statistics  │    │ Performance │    │ Analysis    │         │
│  │ Summary     │───▶│ Metrics     │───▶│ & Recomm.   │         │
│  │ (Both modes)│    │ Calculation │    │             │         │
│  └─────────────┘    └─────────────┘    └─────────────┘         │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │ Column      │    │ Speedup =   │    │ if speedup  │         │
│  │ Statistics  │    │ seq/conc    │    │ > 1.5 then  │         │
│  │ Display     │    │             │    │ "EXCELLENT" │         │
│  └─────────────┘    └─────────────┘    └─────────────┘         │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │ Mean, Min   │    │ Efficiency= │    │ Memory      │         │
│  │ Max, StdDev │    │ speedup/    │    │ Usage       │         │
│  │ Variance    │    │ threads     │    │ Report      │         │
│  └─────────────┘    └─────────────┘    └─────────────┘         │
│         │                   │                   │               │
│         └───────────────────┼───────────────────┘               │
│                             │                                   │
│                             ▼                                   │
│                    ┌─────────────┐                             │
│                    │ Formatted   │                             │
│                    │ Console     │                             │
│                    │ Output      │                             │
│                    └─────────────┘                             │
└─────────────────────────────────────────────────────────────────┘
```

Este diagrama de flujo muestra cómo el sistema implementa todos los conceptos del curso de Java 8 en una arquitectura MVC completa y eficiente para el procesamiento de grandes volúmenes de datos CSV.